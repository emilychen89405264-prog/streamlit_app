import streamlit as st
import os
from google import genai

# ç¶²é æ¨™é¡Œ
st.set_page_config(page_title="æˆ‘çš„ Gemini AI å·¥å…·", page_icon="ğŸ¤–")
st.title("ğŸš€ Gemini å°ˆæ¥­åˆ†æå·¥å…·")

# å´é‚Šæ¬„è¨­å®š
with st.sidebar:
    st.header("è¨­å®š")
    # è®“ä½¿ç”¨è€…å¯ä»¥é¸æ“‡è¦è¼¸å…¥è‡ªå·±çš„ Keyï¼Œæˆ–ä½¿ç”¨é è¨­çš„ (å¦‚æœæ‚¨æƒ³è«‹å®¢)
    user_key = st.text_input("è¼¸å…¥ Gemini API Key", type="password")
    model_choice = st.selectbox("é¸æ“‡æ¨¡å‹", ["gemini-1.5-flash", "gemini-1.5-pro"])

# ä¸»è¦åŠŸèƒ½å€
task_input = st.text_area("è«‹è¼¸å…¥è¦åˆ†æçš„å…§å®¹", placeholder="ä¾‹å¦‚ï¼šæ¯”ç‰¹å¹£ä»Šæ—¥èµ°å‹¢åˆ†æ...")

if st.button("é–‹å§‹åŸ·è¡Œ AI åˆ†æ"):
    # å„ªå…ˆä½¿ç”¨ä½¿ç”¨è€…è¼¸å…¥çš„ Keyï¼Œè‹¥æ²’è¼¸å…¥å‰‡æŠ“ç³»çµ±ç’°å¢ƒè®Šæ•¸
    final_key = user_key if user_key else os.getenv("GEMINI_API_KEY")
    
    if not final_key:
        st.error("âŒ è«‹å…ˆåœ¨å´é‚Šæ¬„è¼¸å…¥ API Keyï¼")
    elif not task_input:
        st.warning("âš ï¸ è«‹è¼¸å…¥åˆ†æå…§å®¹ã€‚")
    else:
        try:
            with st.spinner("AI æ­£åœ¨æ€è€ƒä¸­..."):
                client = genai.Client(api_key=final_key)
                response = client.models.generate_content(
                    model=model_choice,
                    contents=task_input
                )
                st.success("âœ… åˆ†æå®Œæˆï¼")
                st.markdown("### AI å›æ‡‰çµæœï¼š")
                st.write(response.text)
        except Exception as e:
            st.error(f"åŸ·è¡Œç™¼ç”ŸéŒ¯èª¤: {e}")

# é å°¾èªªæ˜
st.info("æç¤ºï¼šé€™æ˜¯ä¸€å€‹ä½¿ç”¨ Streamlit å»ºç«‹çš„ç¶²é å·¥å…·ï¼Œé€£çµåˆ°æ‚¨çš„ GitHub è‡ªå‹•åŸ·è¡Œã€‚")
